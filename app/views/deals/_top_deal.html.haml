%div{ class: "top_deal #{index%3 == 0 ? 'first' : ''}", onclick: "Turbolinks.visit('#{deal_path(deal)}')" }
  %div{ class: "category category_#{deal.category}" }
  .price_and_discount
    .price
      %span.from= t('strings.from_price', price: number_to_currency(deal.real_price))
      %span.by= t('strings.by_price', price: number_to_currency(deal.price))
  .image
    %a{ href: deal_path(deal), id: "deal_photo_#{index}" }
      = Rails.cache.fetch([:deal, :image, deal.id], expires_in: 1.month) { "<img alt='#{deal.get_image_url}' title='#{deal.title}' src='#{deal.get_image_url}'>".html_safe }
  
  .details
    %h4= link_to truncate_title(deal.title, 50), deal_path(deal)
    .user_picture
      %a{ href: user_path(deal.user.username) }
        = cache([:user, :small_picture, deal.user.id], expires_in: 4.hours) do
          %img{ src: deal.user.small_picture }
    .user_infos
      = t('strings.shared_by')
      %br
      = link_to truncate_name(deal.user.name), user_path(deal.user.username)
      %br
      = t('strings.end_date', :end_date => deal.end_date? ? l(deal.end_date.to_date) : "-")

  - if deal.discount > 50
    .discount{ style: "background: url('#{asset_path('red_discount.png')}')  -3px -2px" }= "#{deal.discount.to_i}%"
  - elsif deal.discount > 25
    .discount{ style: "background: url('#{asset_path('orange_discount.png')}')  -3px -2px" }= "#{deal.discount.to_i}%"
  - else
    .discount= "#{deal.discount.to_i}%"

  .clear_right
  .interactions
    %span.love_icon= deal.up_votes
    %span.report_icon= deal.down_votes
